<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical AI - Referto Appuntamento</title>
    <link rel="icon" type="image/png" href="https://medical-ai.it/assets/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/referto.css">
    
    <!-- Iubenda Consent Database Script -->
    <script type="text/javascript">
        var _iub = _iub || {}; 
        _iub.cons_instructions = _iub.cons_instructions || []; 
        _iub.cons_instructions.push(["init", {api_key: "1u2NW5lmpLpqkAau4IorkrcoS9VqavmV"}]);
    </script>
    <script type="text/javascript" src="https://cdn.iubenda.com/cons/iubenda_cons.js" async></script>
</head>
<body>
    <div id="app">
        <!-- Referto Section -->
        <section id="refertoSection" class="referto-container" style="display: none;">
            <!-- Header dinamico -->
            <div id="headerContainer"></div>

            <div class="referto-wrapper">
                <!-- Sidebar dinamico -->
                <div id="sidebarContainer"></div>

                <!-- Main Content -->
                <main class="referto-main">
                    <div class="referto-content">
                        <!-- Page Header with Actions -->
                        <div class="page-header">
                            <div class="header-top">
                                <h2>Referto Appuntamento</h2>
                                <div class="referto-actions">
                                    <button id="savePdfBtn" class="btn-referto btn-primary-color" onclick="savePdfReferto()" title="Salva come PDF">
                                        <i class="fas fa-file-pdf"></i>
                                        <span>Salva PDF</span>
                                    </button>
                                    <button id="printBtn" class="btn-referto btn-primary-color" onclick="printReferto()" title="Stampa">
                                        <i class="fas fa-print"></i>
                                        <span>Stampa</span>
                                    </button>
                                    <button id="sendPatientBtn" class="btn-referto btn-primary-color" onclick="sendToPatient()" title="Invia al Paziente">
                                        <i class="fas fa-envelope"></i>
                                        <span>Invia al Paziente</span>
                                    </button>
                                    <button id="deleteBtn" class="btn-referto btn-danger-color" onclick="deleteReferto()" title="Elimina Referto">
                                        <i class="fas fa-trash-alt"></i>
                                        <span>Elimina</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Referto Header Info -->
                        <div class="referto-header">
                            <div class="referto-info">
                                <div class="info-item">
                                    <label>Data Referto:</label>
                                    <span id="refertoDate">--/--/----</span>
                                </div>
                                <div class="info-item">
                                    <label>Data Visita:</label>
                                    <span id="visitDate">--/--/----</span>
                                </div>
                                <div class="info-item">
                                    <label>Medico:</label>
                                    <span id="medicoName">Dr. Professionista</span>
                                </div>
                                <div class="info-item">
                                    <label>Paziente:</label>
                                    <span id="patientName">Nome Paziente</span>
                                </div>
                            </div>
                        </div>

                        <!-- Odontogramma Section -->
                        <div class="referto-card odontogramma-section">
                            <h3>Odontogramma</h3>
                            <div class="odontogramma-container">
                                <svg id="odontogramma" width="100%" height="300" viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Quadrante 1 (Superiore Destro) -->
                                    <g id="quadrant-1" class="quadrant">
                                        <text x="650" y="30" font-size="16" font-weight="bold" fill="#666">QUAD 1</text>
                                        <rect id="tooth-18" x="650" y="50" width="30" height="40" class="tooth" data-tooth="18"></rect>
                                        <text x="665" y="75" font-size="10" text-anchor="middle" fill="#000">18</text>
                                        
                                        <rect id="tooth-17" x="610" y="50" width="30" height="40" class="tooth" data-tooth="17"></rect>
                                        <text x="625" y="75" font-size="10" text-anchor="middle" fill="#000">17</text>
                                        
                                        <rect id="tooth-16" x="570" y="50" width="30" height="40" class="tooth" data-tooth="16"></rect>
                                        <text x="585" y="75" font-size="10" text-anchor="middle" fill="#000">16</text>
                                        
                                        <rect id="tooth-15" x="530" y="50" width="30" height="40" class="tooth" data-tooth="15"></rect>
                                        <text x="545" y="75" font-size="10" text-anchor="middle" fill="#000">15</text>
                                        
                                        <rect id="tooth-14" x="490" y="50" width="30" height="40" class="tooth" data-tooth="14"></rect>
                                        <text x="505" y="75" font-size="10" text-anchor="middle" fill="#000">14</text>
                                        
                                        <rect id="tooth-13" x="450" y="50" width="30" height="40" class="tooth" data-tooth="13"></rect>
                                        <text x="465" y="75" font-size="10" text-anchor="middle" fill="#000">13</text>
                                        
                                        <rect id="tooth-12" x="410" y="50" width="30" height="40" class="tooth" data-tooth="12"></rect>
                                        <text x="425" y="75" font-size="10" text-anchor="middle" fill="#000">12</text>
                                        
                                        <rect id="tooth-11" x="370" y="50" width="30" height="40" class="tooth" data-tooth="11"></rect>
                                        <text x="385" y="75" font-size="10" text-anchor="middle" fill="#000">11</text>
                                    </g>

                                    <!-- Quadrante 2 (Superiore Sinistro) -->
                                    <g id="quadrant-2" class="quadrant">
                                        <text x="120" y="30" font-size="16" font-weight="bold" fill="#666">QUAD 2</text>
                                        <rect id="tooth-21" x="370" y="50" width="30" height="40" class="tooth" data-tooth="21"></rect>
                                        <text x="385" y="75" font-size="10" text-anchor="middle" fill="#000">21</text>
                                        
                                        <rect id="tooth-22" x="330" y="50" width="30" height="40" class="tooth" data-tooth="22"></rect>
                                        <text x="345" y="75" font-size="10" text-anchor="middle" fill="#000">22</text>
                                        
                                        <rect id="tooth-23" x="290" y="50" width="30" height="40" class="tooth" data-tooth="23"></rect>
                                        <text x="305" y="75" font-size="10" text-anchor="middle" fill="#000">23</text>
                                        
                                        <rect id="tooth-24" x="250" y="50" width="30" height="40" class="tooth" data-tooth="24"></rect>
                                        <text x="265" y="75" font-size="10" text-anchor="middle" fill="#000">24</text>
                                        
                                        <rect id="tooth-25" x="210" y="50" width="30" height="40" class="tooth" data-tooth="25"></rect>
                                        <text x="225" y="75" font-size="10" text-anchor="middle" fill="#000">25</text>
                                        
                                        <rect id="tooth-26" x="170" y="50" width="30" height="40" class="tooth" data-tooth="26"></rect>
                                        <text x="185" y="75" font-size="10" text-anchor="middle" fill="#000">26</text>
                                        
                                        <rect id="tooth-27" x="130" y="50" width="30" height="40" class="tooth" data-tooth="27"></rect>
                                        <text x="145" y="75" font-size="10" text-anchor="middle" fill="#000">27</text>
                                        
                                        <rect id="tooth-28" x="90" y="50" width="30" height="40" class="tooth" data-tooth="28"></rect>
                                        <text x="105" y="75" font-size="10" text-anchor="middle" fill="#000">28</text>
                                    </g>

                                    <!-- Quadrante 3 (Inferiore Sinistro) -->
                                    <g id="quadrant-3" class="quadrant">
                                        <text x="120" y="270" font-size="16" font-weight="bold" fill="#666">QUAD 3</text>
                                        <rect id="tooth-31" x="370" y="210" width="30" height="40" class="tooth" data-tooth="31"></rect>
                                        <text x="385" y="235" font-size="10" text-anchor="middle" fill="#000">31</text>
                                        
                                        <rect id="tooth-32" x="330" y="210" width="30" height="40" class="tooth" data-tooth="32"></rect>
                                        <text x="345" y="235" font-size="10" text-anchor="middle" fill="#000">32</text>
                                        
                                        <rect id="tooth-33" x="290" y="210" width="30" height="40" class="tooth" data-tooth="33"></rect>
                                        <text x="305" y="235" font-size="10" text-anchor="middle" fill="#000">33</text>
                                        
                                        <rect id="tooth-34" x="250" y="210" width="30" height="40" class="tooth" data-tooth="34"></rect>
                                        <text x="265" y="235" font-size="10" text-anchor="middle" fill="#000">34</text>
                                        
                                        <rect id="tooth-35" x="210" y="210" width="30" height="40" class="tooth" data-tooth="35"></rect>
                                        <text x="225" y="235" font-size="10" text-anchor="middle" fill="#000">35</text>
                                        
                                        <rect id="tooth-36" x="170" y="210" width="30" height="40" class="tooth" data-tooth="36"></rect>
                                        <text x="185" y="235" font-size="10" text-anchor="middle" fill="#000">36</text>
                                        
                                        <rect id="tooth-37" x="130" y="210" width="30" height="40" class="tooth" data-tooth="37"></rect>
                                        <text x="145" y="235" font-size="10" text-anchor="middle" fill="#000">37</text>
                                        
                                        <rect id="tooth-38" x="90" y="210" width="30" height="40" class="tooth" data-tooth="38"></rect>
                                        <text x="105" y="235" font-size="10" text-anchor="middle" fill="#000">38</text>
                                    </g>

                                    <!-- Quadrante 4 (Inferiore Destro) -->
                                    <g id="quadrant-4" class="quadrant">
                                        <text x="650" y="270" font-size="16" font-weight="bold" fill="#666">QUAD 4</text>
                                        <rect id="tooth-41" x="370" y="210" width="30" height="40" class="tooth" data-tooth="41"></rect>
                                        <text x="385" y="235" font-size="10" text-anchor="middle" fill="#000">41</text>
                                        
                                        <rect id="tooth-42" x="410" y="210" width="30" height="40" class="tooth" data-tooth="42"></rect>
                                        <text x="425" y="235" font-size="10" text-anchor="middle" fill="#000">42</text>
                                        
                                        <rect id="tooth-43" x="450" y="210" width="30" height="40" class="tooth" data-tooth="43"></rect>
                                        <text x="465" y="235" font-size="10" text-anchor="middle" fill="#000">43</text>
                                        
                                        <rect id="tooth-44" x="490" y="210" width="30" height="40" class="tooth" data-tooth="44"></rect>
                                        <text x="505" y="235" font-size="10" text-anchor="middle" fill="#000">44</text>
                                        
                                        <rect id="tooth-45" x="530" y="210" width="30" height="40" class="tooth" data-tooth="45"></rect>
                                        <text x="545" y="235" font-size="10" text-anchor="middle" fill="#000">45</text>
                                        
                                        <rect id="tooth-46" x="570" y="210" width="30" height="40" class="tooth" data-tooth="46"></rect>
                                        <text x="585" y="235" font-size="10" text-anchor="middle" fill="#000">46</text>
                                        
                                        <rect id="tooth-47" x="610" y="210" width="30" height="40" class="tooth" data-tooth="47"></rect>
                                        <text x="625" y="235" font-size="10" text-anchor="middle" fill="#000">47</text>
                                        
                                        <rect id="tooth-48" x="650" y="210" width="30" height="40" class="tooth" data-tooth="48"></rect>
                                        <text x="665" y="235" font-size="10" text-anchor="middle" fill="#000">48</text>
                                    </g>
                                </svg>
                            </div>

                            <!-- Odontogramma Legend -->
                            <div class="odontogramma-legend">
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #2196F3;"></div>
                                    <span>Denti da estrarre</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #FFC107;"></div>
                                    <span>Conservativa</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #F44336;"></div>
                                    <span>Endodonzia</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #4CAF50;"></div>
                                    <span>Impianto + Corona</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #9C27B0;"></div>
                                    <span>Estrazione + Impianto</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #FF9800;"></div>
                                    <span>Endodonzia + Corona</span>
                                </div>
                            </div>
                        </div>

                        <!-- Referto Text Sections -->
                        <div class="referto-card referto-text-section">
                            <h3>Referto Medico</h3>

                            <!-- Anamnesi -->
                            <div class="referto-subsection">
                                <h4>Anamnesi</h4>
                                <div id="anamneseSection" class="referto-text">
                                    <p id="anamneseText">Testo dell'anamnesi...</p>
                                </div>
                            </div>

                            <!-- Esame Obiettivo -->
                            <div class="referto-subsection">
                                <h4>Esame Obiettivo</h4>
                                <div id="esameSection" class="referto-text">
                                    <p id="esameText">Testo dell'esame obiettivo...</p>
                                </div>
                            </div>

                            <!-- Diagnosi -->
                            <div class="referto-subsection">
                                <h4>Diagnosi</h4>
                                <div id="diagnosiSection" class="referto-text">
                                    <p id="diagnosiText">Testo della diagnosi...</p>
                                </div>
                            </div>

                            <!-- Piano Terapeutico -->
                            <div class="referto-subsection">
                                <h4>Piano Terapeutico</h4>
                                <div id="pianoSection" class="referto-text">
                                    <p id="pianoText">Testo del piano terapeutico...</p>
                                </div>
                            </div>

                            <!-- Follow-up -->
                            <div class="referto-subsection">
                                <h4>Follow-up</h4>
                                <div id="followupSection" class="referto-text">
                                    <p id="followupText">Testo follow-up...</p>
                                </div>
                            </div>

                            <!-- Firma Medico -->
                            <div class="referto-signature">
                                <p><strong>Medico:</strong> <span id="signatureName">Dr. Professionista</span></p>
                                <p style="margin-top: 40px;">________________________</p>
                                <p style="font-size: 0.9em; color: #666;">Firma e Data</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Footer dinamico -->
            <div id="footerContainer"></div>
        </section>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- ============================================================================ -->
    <!-- MODALS -->
    <!-- ============================================================================ -->

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closePrivacyPolicy()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <button onclick="closePrivacyPolicy()" class="modal-close"><i class="fas fa-times"></i></button>
                <h2>Privacy Policy</h2>
                <div class="modal-body">
                    <h3>1. Introduzione</h3>
                    <p>Medical AI si impegna a proteggere la tua privacy.</p>
                    
                    <h3>2. Dati Raccolti</h3>
                    <p>Raccogliamo dati personali durante la registrazione:</p>
                    <ul>
                        <li>Nome e cognome paziente</li>
                        <li>Email e telefono</li>
                        <li>Registrazioni audio appuntamenti</li>
                        <li>Informazioni studio</li>
                    </ul>
                    
                    <h3>3. Utilizzo dei Dati</h3>
                    <p>Utilizziamo i dati per:</p>
                    <ul>
                        <li>Gestire gli appuntamenti</li>
                        <li>Generare referti</li>
                        <li>Comunicazioni cliniche</li>
                        <li>Migliorare i servizi</li>
                    </ul>
                    
                    <h3>4. Protezione dei Dati</h3>
                    <p>Implementiamo misure di sicurezza avanzate per proteggere i tuoi dati.</p>
                    
                    <h3>5. Contatti</h3>
                    <p>Per domande: info@medical-ai.it</p>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="acceptPrivacy()"><i class="fas fa-check"></i> Accetto</button>
                    <button class="btn-secondary" onclick="closePrivacyPolicy()"><i class="fas fa-times"></i> Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms & Conditions Modal -->
    <div id="termsModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeTermsConditions()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <button onclick="closeTermsConditions()" class="modal-close"><i class="fas fa-times"></i></button>
                <h2>Termini e Condizioni</h2>
                <div class="modal-body">
                    <h3>1. Accettazione dei Termini</h3>
                    <p>Utilizzando Medical AI, accetti questi Termini e Condizioni.</p>
                    
                    <h3>2. Descrizione del Servizio</h3>
                    <p>Medical AI fornisce registrazione audio e generazione referti medici.</p>
                    
                    <h3>3. Responsabilità dell'Utente</h3>
                    <ul>
                        <li>Mantenere confidenzialità delle credenziali</li>
                        <li>Ottenere consenso paziente prima di registrare</li>
                        <li>Conformarsi alle leggi sulla privacy</li>
                        <li>Non utilizzare per scopi illegali</li>
                    </ul>
                    
                    <h3>4. Limitazione di Responsabilità</h3>
                    <p>Medical AI non è responsabile per perdite dovute a fattori esterni.</p>
                    
                    <h3>5. Legge Applicabile</h3>
                    <p>Regolato dalle leggi italiane.</p>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="acceptTerms()"><i class="fas fa-check"></i> Accetto</button>
                    <button class="btn-secondary" onclick="closeTermsConditions()"><i class="fas fa-times"></i> Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- SCRIPTS -->
    <!-- ============================================================================ -->
    <script src="js/utils.js"></script>
    <script src="js/consent.js"></script>
    <script src="js/recording-manager.js"></script>
    <script src="js/client-api.js"></script>
    <script src="js/header.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/footer.js"></script>
    <script src="js/referto.js"></script>
</body>
</html>